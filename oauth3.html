<script>
  var params = {};
  var anchor;

  anchor = document.createElement('a');
  anchor.href = window.location.href;
  anchor.search.substr(1).split('&').forEach(function (pair) {
    pair = pair.split('=');
    var key = pair[0];
    var val = pair[1];

    params[decodeURIComponent(key)] = decodeURIComponent(val);
  });

  params.url = window.location.href;

  if (!(params.browser_state || params.state)) {
    window.alert("callback URLs should include 'browser_state' (authorization code)"
      + " or 'state' (implicit grant))");
  }

  setTimeout(function () {
    // opener is for popup window, new tab
    // parent is for iframe
    if (params.callback) {
      (window.opener||window.parent)['__oauth3_' + params.callback](params);
    } else {
      (window.opener||window.parent).completeLogin(null, params.url, params);
    }
  }, 10);

  // iOS Webview (namely Chrome) workaround
  setTimeout(function () {
    window.open('', '_self', '');
    window.close();
  }, 50);

  setTimeout(function () {
    localStorage.setItem('oauth3.' + params.browser_state, JSON.stringify(params));
  }, 0);
</script>

<p>Redirecting... </p>

<a href="javascript:window.opener.completeLogin(name, window.location.href);">close</a>
